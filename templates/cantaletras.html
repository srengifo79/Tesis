<!DOCTYPE HTML>
<html>
    <head>
    	<title>Herramienta Instituto</title>
    	<meta charset="UTF-8" />
    	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
    	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    	<link rel="icon" href="http://www.ciegosysordos.org.co/wp/wp-content/uploads/2018/01/cropped-favicon_instituto_ciegos_sordos_valle_cauca-1-32x32.png" sizes="32x32" />
      	<link rel="icon" href="http://www.ciegosysordos.org.co/wp/wp-content/uploads/2018/01/cropped-favicon_instituto_ciegos_sordos_valle_cauca-1-192x192.png" sizes="192x192" />
      	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      	<script src="http://code.responsivevoice.org/responsivevoice.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    </head>
    <body>
        <div id="pagina" class="container" style="page-break-inside: avoid; height: 100%; width: 100%;">
          <div class="row">
            <div class="col-sm-6">
                <div class="row">
                  <h4 id="pregunta"></h4>
                </div>
                <div class="row">
                  <input type="text" id="respuesta" style="max-width: 60%;" autofocus></input>
                </div>
            </div>
          </div>
        </div>
        
        <div class="modal fade" id="menu" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Menu</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <p>Cambiar velocidad de lectura de pantalla</p>
                <input type="range" min="1" max="15" value="1" class="slider" id="lectura_pantalla">
                <p>Abandonar actividad</p>
                <button type="button" class="btn btn-danger" id="abandonar">Abandonar</button>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="guardar_config">Guardar</button>
              </div>
            </div>
          </div>
        </div>
        
        <!--<div><a href="https://responsivevoice.org">ResponsiveVoice-NonCommercial</a> licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><img title="ResponsiveVoice Text To Speech" src="https://responsivevoice.org/wp-content/uploads/2014/08/95x15.png" alt="95x15" width="95" height="15" /></div>-->
        
        <script charset="UTF-8">
            
            const estadosActividad = ["contando el cuento", "cuento terminado","pregunta", "respuesta"];
            
            const cuento = "Este es un cuento corto para una prueba";
            //"Sofía era una niña de apenas 9 años, llena de curiosidad pero muy tímida. Como no tenía padres, vivía junto a otras niñas en un orfanato de Inglaterra. Le gustaba estar sola y no tenía muchos amigos. Un día, o mejor dicho, una noche, algo le llamó la atención. Esa noche Sofía no podía dormir, y se asomó a la ventana. Entonces le vio: era grande, muy grande. era un ¡gigante! Al principio Sofía tuvo miedo. Pensó que el gigante le haría daño. Pero el gigante le trató desde el principio con dulzura. Resultó ser un gigante bonachón. El gigante le llevó hasta el mundo en donde vivía. Le enseñó todos los secretos sobre su país y su gente. Por ejemplo, le contó por qué los gigantes tienen esas orejas tan grandes. ¿Quieres saberlo? Chsss.. pero es un secreto: Los gigantes pueden oír gracias a sus enormes orejas. ¡todos los secretos de las personas! Sí, los gigantes oyen sonidos que nadie puede escuchar. Escuchan los pensamientos y son capaces de oír a los corazones hablar. Los gigantes son capaces de volar, siempre que se toman Gasipum, una bebida especial. Además, corren muy deprisa, gracias a sus larguísimas piernas.El gigante bonachón no lee cuentos, sino sueños. Sus libros están escritos con sueños que consiguen cazar al vuelo. Gracias a los sueños que lee el gigante Bonachón, Sofía duerme tranquila y sin pesadillas, y por muy tontos que parezcan esos sueños, siempre funcionan. De hecho, el gigante Bonachón narra los sueños sobre los libros, unos libros mágicos. Cuando empieza a contarlos, ya no pueden parar. Pero no penséis que todos los gigantes son así de buenos. En el país de los gigantes, también hay malos. De hecho, uno de ellos quería hacer daño a Sofía y a todos los niños del planeta. El gigante bonachón decidió hacerles frente, con ayuda de Sofía y de la mismísima reina de Inglaterra. Todos juntos (incluidos los sueños atrapados por el gigante bonachón) pudieron parar a los gigantes malos. Desde entonces, y par evitar nuevos problemas, los gigantes decidieron esconderse en su mundo. Pero yo sé una cosa que muchos no saben: de vez en cuando, dejan entrar a algún niño, para contarles todos sus secretos. Que además, son muchos."
            
            const preguntas = ["Pregunta 1","Pregunta 2"];
            
            const respuestasActividad = ['Si', 'Cinco'];
            
            var estadoActualActividad;
            
            var respuestasUsuario = [];
            
            var indicePreguntas = 0;
            
            var numeroIntentos = 3;
            
            function cargarConfiguracionUsuario(){
                var colorFondo = '{{ conf[0] }}';
                var colorFuente = '{{ conf[1] }}';
                var tamanoFuente = '{{ conf[2] }}';
                window.velocidadLectura = ('{{ conf[3] }}' / 10);
                console.log('{{ conf }}');
                document.body.style.backgroundColor = colorFondo;
                document.getElementById("pregunta").style.color = colorFuente;
                document.getElementById("pregunta").style.fontSize = tamanoFuente;
                document.getElementById("respuesta").style.color = colorFuente;
                document.getElementById("respuesta").style.fontSize = tamanoFuente;
            }
            
            function finCuento(){
                estadoActualActividad = estadosActividad[1];
                responsiveVoice.speak("Listo para las preguntas?", "Spanish Latin American Female", {rate: (window.velocidadLectura)})
            }
            
            function iniciarCuento(){
                estadoActualActividad = estadosActividad[0];
                responsiveVoice.speak(cuento, "Spanish Latin American Female", {rate: (window.velocidadLectura), onend: finCuento})
            }
            
            function repetirCuento(){
                estadoActualActividad = estadosActividad[0]
                responsiveVoice.speak("Repasemos el cuento de nuevo", "Spanish Latin American Female", {rate: (window.velocidadLectura), onend: iniciarCuento})
            }
            
            function leerPregunta(){
                estadoActualActividad = estadosActividad[3];
                
                const pregunta = preguntas[indicePreguntas];
                document.getElementById("pregunta").innerHTML = pregunta;
                responsiveVoice.speak(pregunta, "Spanish Latin American Female", {rate: (window.velocidadLectura), onend: function(){estadoActualActividad = estadosActividad[4]}})
            }
            
            function capturarRespuesta(){
                const respuestaUsuario = document.getElementById("respuesta").value;
                const respuestaCorrecta = respuestasActividad[indicePreguntas];
                
                respuestasUsuario.push(respuestaUsuario);
                indicePreguntas = indicePreguntas + 1;
                validarRespuesta(respuestaUsuario, respuestaCorrecta);
            }
            
            function estandarizarRespuesta(texto){
                texto = texto.replace(/\s+/g,'');
                texto = texto.toLowerCase();
                console.log(texto)
                return texto;
            }
            
            function validarRespuesta(respuestaUsuario, respuestaCorrecta){
                respuestaUsuario = estandarizarRespuesta(respuestaUsuario);
                respuestaCorrecta = estandarizarRespuesta(respuestaCorrecta);
                
                console.log(respuestaUsuario, respuestaCorrecta);
                
                const regex = new RegExp(respuestaCorrecta,"g");
                
                if(respuestaUsuario.match(regex)){
                    responsiveVoice.speak("Correcto, felicitaciones", "Spanish Latin American Female", {rate: (window.velocidadLectura)});
                    document.getElementById("pregunta").innerHTML = "Correcto";
                } else {
                    responsiveVoice.speak("Incorrecto", "Spanish Latin American Female", {rate: (window.velocidadLectura)});
                    document.getElementById("pregunta").innerHTML = "Incorrecto";
                }
            }
            
            function validarFinPreguntas(){
                
                if(indicePreguntas == preguntas.length){
                    window.location = "/MenuInicio";
                } else {
                    leerPregunta();
                }
            }
            
            document.getElementById("lectura_pantalla").oninput = function () {
                if (responsiveVoice.isPlaying()) responsiveVoice.cancel;
                responsiveVoice.speak("prueba de velocidad de lectura", "Spanish Latin American Female", {rate: (this.value/10)});
            }
            
            document.getElementById("guardar_config").onclick = function () {
                window.velocidadLectura = (document.getElementById("lectura_pantalla").value / 10);
                $('#menu').modal();
            };
            
            document.getElementById("abandonar").onclick = function () {
                window.location = "/MenuInicio";
            }
            
            document.onkeydown = function(evt) {
                evt = evt || window.event;
                if (evt.keyCode == 27) {
                    $('#menu').modal();
                } else if(evt.keyCode == 83 && estadoActualActividad == estadosActividad[1]){ 
                    leerPregunta();
                } else if(evt.keyCode == 78 && estadoActualActividad == estadosActividad[1]){
                    repetirCuento();
                } else if(evt.keyCode == 13 && estadoActualActividad == estadosActividad[4]){
                    capturarRespuesta();
                    setTimeout(function(){validarFinPreguntas()}, 3000);
                }
            };
            
            cargarConfiguracionUsuario()
            
            iniciarCuento()
            
        </script>
        
    </body>
    
    <style>
		#header {
			padding: 2em 0 0.1em 0 !important;
		}
		
		.slidecontainer {
		  width: 100%;
		}
		
		.slider {
		  -webkit-appearance: none;
		  width: 100%;
		  height: 25px;
		  background: #d3d3d3;
		  outline: none;
		  opacity: 0.7;
		  -webkit-transition: .2s;
		  transition: opacity .2s;
		}
		
		.slider:hover {
		  opacity: 1;
		}
		
		.slider::-webkit-slider-thumb {
		  -webkit-appearance: none;
		  appearance: none;
		  width: 25px;
		  height: 25px;
		  background: #00A6D8;
		  cursor: pointer;
		}
		
		.slider::-moz-range-thumb {
		  width: 25px;
		  height: 25px;
		  background: #00A6D8;
		  cursor: pointer;
		}
	</style>
    
        
    
</html>